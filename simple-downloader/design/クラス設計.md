# クラス設計
## 全体の構造：3つの層に分かれています
【抽象層】   IDownloaderObserver  /  ICurlHandle
               ↑ implements          ↑ implements
【本番層】   ConsoleObserver      /  CurlHandle  ←→  Downloader
【テスト層】  MockObserver         /  MockCurlHandle

## 各クラスの役割
Downloader（中心クラス）
- システムの司令塔です。curl の呼び出し、スレッド管理、状態機械、オブザーバー通知をすべて担います。内部に atomic + condition_variable + mutex を持ち、スレッドセーフを自力で保証します。

ICurlHandle（インターフェース）
- libcurl 操作を抽象化した境界線です。このインターフェースがあるおかげで、本番では CurlHandle、テストでは MockCurlHandle に差し替えられます。これが依存性逆転の原則（DIP）の核心です。

CurlHandle（本番実装）
- CURL* ハンドルを RAII で管理します。静的コールバック（curlWriteCallback）を経由してメンバー関数に橋渡しするブリッジパターンを採用しています（C API の制約への対処）。

IDownloaderObserver（インターフェース）
- UI や上位モジュールへの通知口です。ワーカースレッドから呼ばれるため、実装側はスレッドセーフに注意が必要です。

MockCurlHandle / MockObserver（テスト層）
- ネットワーク接続なしで全動作をシミュレートします。MockObserver は condition_variable で非同期イベントを待機できるため、sleep に依存しない再現性の高いテストが書けます。

## 重要な関係
関係説明
- Downloader ◇── IDownloaderObserver : 集約（0個以上のオブザーバーを保持）
- Downloader ──> ICurlHandle : ファクトリ経由で生成（直接所有しない）
- CurlHandle ──▷ ICurlHandle : 本番実装の継承
- MockCurlHandle ──▷ ICurlHandle : テスト用の差し替え可能な代替品